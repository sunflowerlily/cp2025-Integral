# 项目4：双线圈系统（含亥姆霍兹线圈）的磁场计算与可视化

## 目标

本项目旨在通过编程计算并可视化由两个共轴圆形线圈产生的磁场分布。特别地，我们将关注亥姆霍兹线圈的配置，即当两个**相同的**圆形线圈共轴放置，且它们之间的距离等于线圈的半径时。当两个线圈中通以相同方向、相同大小的电流时，亥姆霍兹线圈在其中心区域产生一个相对均匀的磁场。

本代码中的核心计算函数允许两个线圈具有不同的半径，但亥姆霍兹线圈的特性仅在半径相同且满足特定间距条件时显现。

## 背景

单个半径为 $R_{coil}$、载有电流 $I$ 的圆形线圈，在其轴线上距离圆心为 $z_{rel}$ 处的磁感应强度大小（只有 $z$ 分量）为：

$$
B_z(0, z_{rel}) = \frac{\mu_0 I R_{coil}^2}{2(R_{coil}^2 + z_{rel}^2)^{3/2}}
$$

其中 $\mu_0$ 是真空磁导率 ($\mu_0 = 4\pi \times 10^{-7} \text{ T}\cdot\text{m/A}$)。

对于由两个这样的线圈组成的系统：
*   **线圈1 (代码中对应 `r_low`)**: 半径 $R_1$，中心位于 $z_{c1} = +d/2$ (根据您代码中 `r1` 的 `Z-d/2` 项推断)
*   **线圈2 (代码中对应 `r_up`)**: 半径 $R_2$，中心位于 $z_{c2} = -d/2$ (根据您代码中 `r2` 的 `Z+d/2` 项推断)
其中 $d$ 是两个线圈中心之间的轴向距离。

**对于标准的亥姆霍兹线圈：**
1.  两个线圈半径相同： $R_1 = R_2 = R$
2.  线圈间距等于半径： $d = R$

空间中任意一点的磁场是两个线圈产生磁场的矢量和（磁场叠加原理）。

## 任务

1.  **双线圈系统磁场的计算方法:**
*   **核心计算函数:** 实现一个函数，计算由两个共轴圆形线圈（半径分别为 $R_1, R_2$，中心分别位于 $z=+d/2, z=-d/2$，电流 $I$）在任意离轴点产生的磁场矢量分量。
*   **计算平面:** 由于轴对称性，通常选择一个包含 $z$ 轴的平面进行计算，例如 $yz$-平面（笛卡尔坐标 $y, z$ 且 $x=0$）。在此平面中，$y$ 坐标对应于柱坐标中的径向距离 $r$。
*   **毕奥-萨伐尔定律应用:** 磁场分量需要通过对整个线圈上的电流元 $Id\mathbf{l}$ 应用毕奥-萨伐尔定律并进行数值积分来获得：

$$ d\mathbf{B} = \frac{\mu_0 I}{4\pi} \frac{d\mathbf{l} \times \mathbf{r}'}{|\mathbf{r}'|^3} $$

其中 $\mathbf{r}'$ 是从电流元 $d\mathbf{l}$ 指向场点的矢量。对 $d\mathbf{B}$ 的分量（例如 $dB_y$ 和 $dB_z$ 如果在 $yz$-平面计算）沿线圈路径（通常是角度 $\phi'$ 从 $0$ 到 $2\pi$）进行积分。
对于位于 $z=z_{coil}$，半径为 $R_{coil}$ 的线圈，在场点 $(0,Y,Z)$ 处，电流元产生的磁场分量被积函数的核心部分（忽略 $1/|\mathbf{r}'|^3$ 和常数）为：
         *   $dB_y$ 贡献: $R_{coil} (Z-z_{coil}) \sin\phi'$
         *   $dB_z$ 贡献: $R_{coil} (R_{coil} - Y\sin\phi')$
        *   **数值积分:** 使用 `numpy.trapezoid` (梯形法则) 进行数值积分。

2.  **亥姆霍兹线圈配置下的平面内磁场可视化:**
    *   **设置参数:** 为分析亥姆霍兹线圈，需设置线圈半径相同 ($R_1=R_2=R$) 且线圈间距等于该半径 ($d=R$)。
    *   **计算:** 利用上述核心计算函数，在 $yz$-平面上的一系列网格点产生总磁场矢量 $(B_y^{total}, B_z^{total})$。
    *   **可视化:**
        *   绘制 $yz$-平面内的 **磁场线** (使用 `plt.streamplot`)。
        *   (可选) 绘制 $yz$-平面内的磁感应强度大小 $|B| = \sqrt{(B_y^{total})^2 + (B_z^{total})^2}$ 的 **等值线图** (使用 `plt.contourf` 或 `plt.imshow`)。

## 参数设定 (示例，请根据您的代码和需求调整)

*   真空磁导率: $\mu_0 = 4\pi \times 10^{-7} \text{ T}\cdot\text{m/A}$
*   电流: $I = 1.0 \text{ A}$
*   **对于亥姆霍兹线圈:**
    *   线圈1半径 (`r_low`): $R = 0.5 \text{ m}$ (示例)
    *   线圈2半径 (`r_up`): $R = 0.5 \text{ m}$ (与线圈1相同)
    *   线圈间距 (`d`): $d = R = 0.5 \text{ m}$
*   您的代码允许 `r_low`, `r_up`, 和 `d` 独立设置，以探索非亥姆霍兹配置。

## 提示

*   **坐标系与线圈位置:** 您的代码假设计算在 $yz$-平面 ($x=0$)。
    *   线圈1 (参数 `r_low`) 中心在 $z = +d/2$。
    *   线圈2 (参数 `r_up`) 中心在 $z = -d/2$。
*   **Helmholtz 条件:** 核心是 $R_1 = R_2 = R$ 且 $d = R$。
*   **可视化范围:** 选择合适的绘图范围（例如 $y \in [-2R, 2R]$， $z \in [-1.5d, 1.5d]$），确保能清晰展示两个线圈之间以及线圈外部一定区域的磁场特性。
*   **轴线上的场 (y=0):** 您的离轴磁场计算函数在 $y=0$ 时，其 $B_z$ 分量应与简单的轴线上磁场公式结果一致， $B_y$ 分量应为零。这可以作为验证方法之一。
*   **绘图函数注意:** 您提供的 `plot_magnetic_field_streamplot` 函数内部调用 `Helmholtz_coils(.5,.5,0.8)` 时使用了硬编码的参数。为使其能根据函数输入参数 `r_low, r_up, d` 灵活绘图，应修改为使用这些传入的参数进行计算。同样，标题中的参数也应动态获取。
